//Database Creation
create database Colleagues

//Tables Creation
create table Users(
userId int unsigned auto_increment primary key,
userName varchar(30) not null,
password varchar(64) not null
);

create table Categories(
categoryId int primary key,
categoryName varchar(18) not null
);

create table Status(
statusId int primary key,
statusValue varchar(8) not null
);

create table UsersTypes(
typeId int primary key,
typeValue varchar(5) not null
);

create table SubCategories(
subCategoryId varchar(2) not null,
subCategoryName varchar(18) not null,
categoryId int not null,
primary key (subCategoryId),
foreign key (categoryId) references Categories(categoryId)
);

create table UsersRelation(
userId int unsigned not null,
subCategoryId varchar(2) not null,
statusId int not null,
typeId int not null,
foreign key (userId) references Users(userId),
foreign key (subCategoryId) references SubCategories(subCategoryId),
foreign key (statusId) references Status(statusId),
foreign key (typeId) references UsersTypes(typeId)
);

//Data insertion
insert into Categories values(0,"IT");
insert into Categories values(1,"Management");
insert into Categories values(2,"Supporting Staff");

insert into SubCategories values("0a","Data Engineer",0);
insert into SubCategories values("0b","Designer",0);
insert into SubCategories values("0c","Developer",0);
insert into SubCategories values("0d","Software Engineer",0);
insert into SubCategories values("0e","SEO Expert",0);
insert into SubCategories values("1a","HR Manager",1);
insert into SubCategories values("1b","Manager",1);
insert into SubCategories values("1c","Product Designer",1);
insert into SubCategories values("2a","Cleaning Staff",2);
insert into SubCategories values("2b","Cook",2);
insert into SubCategories values("2c","Guard",2);
insert into SubCategories values("2d","Office Boy",2);

insert into Status values(0,"Active");
insert into Status values(1,"Delete");
insert into Status values(2,"Inactive");

insert into UsersTypes values(0,"Admin");
insert into UsersTypes values(1,"User");

//Stored Procedures
delimiter //
create procedure UserCreation(
in username varchar(30),
in pass varchar(64),
in subcategory varchar(2),
in statusid int,
in typeid int
)
begin
     insert into Users(userName,password)values(username,pass); 
     set @userid := LAST_INSERT_ID();
     insert into UsersRelation values(@userid,subcategory,statusid,typeid);
      
end //
delimiter ;

call UserCreation("manny","sjhksahdjdgh44d","0d",1,1);


delimiter //
create procedure UserLogin(
in username varchar(30),
in pass varchar(64),
out id int,
out type int
)
begin
     select userId into id from Users where userName = username and password = pass;  
     IF id IS NOT NULL THEN
         select typeId into type from UsersRelation where userId = id;
     END IF; 
end //
delimiter ;

set @userid = -1;
set @usertype = -1;
call UserLogin("manny","sjhksahdjdgh44d",@userid,@usertype);
select @userid;
select @usertype;
